import { v4 as uuidv4 } from 'uuid';
export function getOrCreateDeviceId(){ if(typeof window==='undefined') return null; let id=localStorage.getItem('device_id'); if(!id){id=uuidv4(); localStorage.setItem('device_id',id);} return id; }
export async function registerDevice(token){ const deviceId = getOrCreateDeviceId(); const deviceInfo = { ua: typeof navigator !== 'undefined' ? navigator.userAgent : 'node' }; const res = await fetch('/api/devices/register',{method:'POST',headers:{'Content-Type':'application/json', Authorization:`Bearer ${token}`}, body: JSON.stringify({deviceId, deviceInfo})}); if(!res.ok){ const j = await res.json(); return {ok:false, error:j.error || 'Registration failed'} } return {ok:true}; }
